// src/pages/AmigoDetails/components/AmigoDetailsItem.tsx
import React from 'react';
import { AmigoDetails } from '@/types/AmigoDetailsTypes';
import { Amigo } from '@/types/AmigoTypes';
import styles from '../AmigoDetails.module.scss';

interface AmigoDetailsItemProps {
  amigoDetails: AmigoDetails | null; // <-- match the prop name used below
  amigo: Amigo;
}

// Utility function to format keys for display
const formatString = (key: string): string =>
  key.replace(/_/g, ' ').replace(/\b\w/g, (c) => c.toUpperCase());

const AmigoDetailsItem: React.FC<AmigoDetailsItemProps> = ({ amigoDetails, amigo }) => {
  const firstName = amigo.first_name || 'Unknown';
  const lastName = amigo.last_name || 'Unknown';

  if (!amigoDetails) {
    return (
      <div className={styles.amigoDetailItem} aria-labelledby={styles.amigoDetailItem__header}>
        <h2 className={styles.amigoDetailsItem__header} id={styles.amigoDetailsItem__header}>
          Details for {firstName} {lastName}
        </h2>
        <p className={`${styles.amigoDetailsItem__message} prose`}>Message: No details information found.</p>
      </div>
    );
  }

  // Exclude ids/relations/objects (e.g., 'locations') from the list
  const detailFields = Object.entries(amigoDetails).filter(([key, value]) =>
    value !== null &&
    value !== undefined &&
    key !== 'id' &&
    key !== 'amigo' &&
    key !== 'amigo_id' &&
    key !== 'locations' &&        // explicit, though typeof object covers it
    typeof value !== 'object'
  );

  return (
    <div className={styles.amigoDetailsItem} aria-labelledby={styles.amigoDetailsItem__header}>
      <h3 className={styles.amigoDetailsItem__header} id="amigoDetailsItem__header">
        Details for {firstName} {lastName}
      </h3>

      <p className={styles.amigoDetailsItem__field}>Amigo Id: {amigo.id}</p>

      {detailFields.length > 0 ? (
        <ul className={styles.amigoDetailsItem__fields}>
          {detailFields.map(([key, value]) => {
            const displayValue = typeof value === 'boolean' ? (value ? 'Yes' : 'No') : value;
            return (
              <li key={key} className={'{styles.amigoDetailsItem__field} prose'}>
                {formatString(key)}:&nbsp;{displayValue}
              </li>
            );
          })}
        </ul>
      ) : (
        <p className="amigoDetailsItem__message">Message: No details information found.</p>
      )}
    </div>
  );
};

export default AmigoDetailsItem;
